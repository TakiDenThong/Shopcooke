<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mini KOF Perfect - Gun Mode</title>
  <style>
    body {
      margin: 0;
      background: #111;
      color: white;
      font-family: sans-serif;
      text-align: center;
    }

    canvas {
      background: #222;
      display: block;
      margin: 20px auto;
      border: 5px solid white;
    }

    .controls-wrapper {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    .control-group {
      margin: 10px;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    .controls button {
      padding: 10px 15px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background: #444;
      color: white;
      cursor: pointer;
    }

    .controls button:active {
      background: #888;
    }

    #restartBtn {
      display: none;
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 18px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    #restartBtn:hover {
      background: #0056b3;
    }

    h1 {
      margin: 10px 0;
    }

    h2 {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>üëë Mini King of Fighters - Gun Edition</h1>
  <p>Player 1: W/A/D | F = Punch | G = Shoot<br>Player 2: ‚Üë/‚Üê/‚Üí | L = Punch | ; = Shoot</p>
  <canvas id="gameCanvas" width="800" height="300"></canvas>

  <!-- Restart Button -->
  <button id="restartBtn" onclick="restartGame()">üîÅ Play Again</button>

  <!-- Separated Controls -->
  <div class="controls-wrapper">
    <!-- Player 1 Controls -->
    <div class="control-group">
      <h2>Player 1 Controls</h2>
      <div class="controls">
        <button onclick="press('a')">‚Üê</button>
        <button onclick="press('d')">‚Üí</button>
        <button onclick="press('w')">‚Üë</button>
        <button onmousedown="hold('f')" onmouseup="release('f')">Punch</button>
        <button onclick="press('g')">Shoot</button>
      </div>
    </div>

    <!-- Player 2 Controls -->
    <div class="control-group">
      <h2>Player 2 Controls</h2>
      <div class="controls">
        <button onclick="press('arrowleft')">‚Üê</button>
        <button onclick="press('arrowright')">‚Üí</button>
        <button onclick="press('arrowup')">‚Üë</button>
        <button onmousedown="hold('l')" onmouseup="release('l')">Punch</button>
        <button onclick="press(';')">Shoot</button>
      </div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const restartBtn = document.getElementById("restartBtn");

    class Fighter {
      constructor(x, color, controls, imageSrc) {
        this.x = x;
        this.y = 220;
        this.width = 40;
        this.height = 80;
        this.color = color;
        this.controls = controls;
        this.velX = 0;
        this.velY = 0;
        this.isOnGround = true;
        this.health = 100;
        this.isPunching = false;
        this.bullets = [];
        this.lastShotTime = 0;
        this.shootCooldown = 3000;
        this.image = new Image();
        this.image.src = imageSrc;
      }

      draw() {
        if (this.image.complete) {
          ctx.drawImage(this.image, this.x, this.y, this.width, this.height);
        } else {
          ctx.fillStyle = this.color;
          ctx.fillRect(this.x, this.y, this.width, this.height);
        }

        if (this.isPunching) {
          ctx.fillStyle = "yellow";
          const punchX = this.color === "red" ? this.x + this.width : this.x - 10;
          ctx.fillRect(punchX, this.y + 20, 10, 10);
        }

        this.drawBullets();
      }

      update() {
        this.x += this.velX;
        this.y += this.velY;

        if (!this.isOnGround) this.velY += 0.5;

        if (this.y >= 220) {
          this.y = 220;
          this.velY = 0;
          this.isOnGround = true;
        }

        if (this.x < 0) this.x = 0;
        if (this.x + this.width > canvas.width) this.x = canvas.width - this.width;

        this.updateBullets();
      }

      jump() {
        if (this.isOnGround) {
          this.velY = -10;
          this.isOnGround = false;
        }
      }

      shoot() {
        const now = Date.now();
        if (now - this.lastShotTime < this.shootCooldown) return;
        this.lastShotTime = now;

        const dir = this.color === "red" ? 1 : -1;
        this.bullets.push({
          x: this.x + this.width / 2,
          y: this.y + this.height / 2,
          radius: 5,
          speed: dir * 5,
          hit: false
        });
      }

      drawBullets() {
        ctx.fillStyle = "orange";
        this.bullets.forEach(b => {
          ctx.beginPath();
          ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
          ctx.fill();
        });
      }

      updateBullets() {
        this.bullets.forEach(b => {
          b.x += b.speed;
        });
        this.bullets = this.bullets.filter(b => b.x > 0 && b.x < canvas.width && !b.hit);
      }
    }

    const player1 = new Fighter(
      100, "red",
      { left: "a", right: "d", up: "w", punch: "f", shoot: "g" },
      "https://p.novaskin.me/4949993940.png"
    );

    const player2 = new Fighter(
      650, "blue",
      { left: "arrowleft", right: "arrowright", up: "arrowup", punch: "l", shoot: ";" },
      "https://p.novaskin.me/5105674051.png"
    );

    const keys = {};
    let gameOver = false;

    document.addEventListener("keydown", (e) => {
      const key = e.key.toLowerCase();
      keys[key] = true;
      if (key === player1.controls.shoot) player1.shoot();
      if (key === player2.controls.shoot) player2.shoot();
    });

    document.addEventListener("keyup", (e) => {
      const key = e.key.toLowerCase();
      keys[key] = false;
      if (key === player1.controls.punch) player1.isPunching = false;
      if (key === player2.controls.punch) player2.isPunching = false;
    });

    function press(key) {
      key = key.toLowerCase();
      keys[key] = true;
      document.dispatchEvent(new KeyboardEvent("keydown", { key }));
      setTimeout(() => {
        keys[key] = false;
        document.dispatchEvent(new KeyboardEvent("keyup", { key }));
      }, 100);
    }

    function hold(key) {
      key = key.toLowerCase();
      keys[key] = true;
      document.dispatchEvent(new KeyboardEvent("keydown", { key }));
    }

    function release(key) {
      key = key.toLowerCase();
      keys[key] = false;
      document.dispatchEvent(new KeyboardEvent("keyup", { key }));
    }

    function checkHit(p1, p2) {
      return p1.isPunching &&
        Math.abs(p1.x + p1.width / 2 - (p2.x + p2.width / 2)) < 50 &&
        Math.abs(p1.y - p2.y) < 40;
    }

    function checkBulletHit(bullets, target) {
      bullets.forEach((b) => {
        if (
          b.x > target.x &&
          b.x < target.x + target.width &&
          b.y > target.y &&
          b.y < target.y + target.height
        ) {
          target.health -= 30;
          b.hit = true;
        }
      });
    }

    function drawHealthBars() {
      ctx.fillStyle = "white";
      ctx.fillText("P1", 20, 20);
      ctx.fillRect(50, 10, player1.health * 2, 10);

      ctx.fillText("P2", 700, 20);
      ctx.fillRect(740 - player2.health * 2, 10, player2.health * 2, 10);
    }

    function displayWinner() {
      const winner = player1.health <= 0 ? "üëë Player 2 Wins!" : "üëë Player 1 Wins!";
      ctx.fillStyle = "yellow";
      ctx.font = "30px sans-serif";
      ctx.fillText(winner, canvas.width / 2 - 130, canvas.height / 2);
      restartBtn.style.display = "inline-block";
      gameOver = true;
    }

    function restartGame() {
      player1.health = 100;
      player2.health = 100;
      player1.x = 100;
      player2.x = 650;
      player1.bullets = [];
      player2.bullets = [];
      player1.isPunching = false;
      player2.isPunching = false;
      gameOver = false;
      restartBtn.style.display = "none";
      gameLoop();
    }

    function gameLoop() {
      if (gameOver) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      player1.velX = 0;
      player2.velX = 0;

      if (keys[player1.controls.left]) player1.velX = -2;
      if (keys[player1.controls.right]) player1.velX = 2;
      if (keys[player1.controls.up]) player1.jump();
      if (keys[player1.controls.punch]) player1.isPunching = true;

      if (keys[player2.controls.left]) player2.velX = -2;
      if (keys[player2.controls.right]) player2.velX = 2;
      if (keys[player2.controls.up]) player2.jump();
      if (keys[player2.controls.punch]) player2.isPunching = true;

      player1.update();
      player2.update();

      if (checkHit(player1, player2)) player2.health -= 1;
      if (checkHit(player2, player1)) player1.health -= 1;

      checkBulletHit(player1.bullets, player2);
      checkBulletHit(player2.bullets, player1);

      drawHealthBars();
      player1.draw();
      player2.draw();

      if (player1.health <= 0 || player2.health <= 0) {
        displayWinner();
        return;
      }

      requestAnimationFrame(gameLoop);
    }

    gameLoop();
  </script>
</body>
</html>

